"use strict";(()=>{var e={};e.id=752,e.ids=[752],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3258:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>T,staticGenerationAsyncStorage:()=>h});var r={};n.r(r),n.d(r,{GET:()=>u,POST:()=>p,dynamic:()=>d});var a=n(9182),i=n(2007),o=n(6719),c=n(3442),s=n(3524),g=n(8676);let d="force-dynamic",l=new s.PrismaClient;async function u(e){try{let{searchParams:t}=new URL(e.url),n=parseInt(t.get("hours")||"24"),r=new g.Z(l),a=await r.analyzeTrends(n);return c.NextResponse.json(a)}catch(e){return console.error("Error analyzing trends:",e),c.NextResponse.json({error:"Failed to analyze trends"},{status:500})}}async function p(){try{let e=new g.Z(l),t=await e.analyzeTrends(24);return c.NextResponse.json({message:"Trending analysis completed",analysis:t})}catch(e){return console.error("Error running trending analysis:",e),c.NextResponse.json({error:"Failed to run trending analysis"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/trending/route",pathname:"/api/trending",filename:"route",bundlePath:"app/api/trending/route"},resolvedPagePath:"/home/ubuntu/ai_tweet_monitor/app/app/api/trending/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:T}=w,y="/api/trending/route";function S(){return(0,o.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:h})}},8676:(e,t,n)=>{n.d(t,{Z:()=>a});class r{constructor(e){this.prisma=e}async analyzeTrends(e=24){let t=new Date(Date.now()-36e5*e);try{await this.calculateTweetTrendingScores(t),await this.calculateTopicTrendingScores(t);let e=await this.getTopTrendingTweets(50),n=await this.getTopTrendingTopics(20),r=await this.generateInsights(t);return{topTrendingTweets:e,topTrendingTopics:n,insights:r}}catch(e){throw console.error("Error analyzing trends:",e),e}}async calculateTweetTrendingScores(e){try{for(let t of(await this.prisma.tweet.findMany({where:{createdAt:{gte:e}},include:{analytics:{orderBy:{recordedAt:"desc"},take:5},account:!0}}))){let e=this.calculateTweetTrendingScore(t);await this.prisma.tweet.update({where:{id:t.id},data:{trendingScore:e,isTrending:e>parseFloat(process.env.TRENDING_THRESHOLD||"50")}})}}catch(e){throw console.error("Error calculating tweet trending scores:",e),e}}calculateTweetTrendingScore(e){let t=(Date.now()-e.createdAt.getTime())/36e5,n=0;if(e.analytics.length>=2){let t=e.analytics[0],r=e.analytics[1],a=(t.recordedAt.getTime()-r.recordedAt.getTime())/36e5;a>0&&(n=(t.engagementScore-r.engagementScore)/a)}let r=e.account.followerCount?Math.log10(e.account.followerCount+1)/10:1;return Math.max(0,e.engagementScore*Math.max(.1,1-t/168)/r+10*n)}async calculateTopicTrendingScores(e){try{for(let t of(await this.prisma.trendingTopic.findMany({where:{lastSeen:{gte:e},isActive:!0}}))){let e=await this.prisma.tweet.count({where:{OR:[{hashtags:{has:t.topic}},{mentions:{has:t.topic}}],createdAt:{gte:new Date(Date.now()-216e5)}}})/6,n=t.engagementSum/Math.max(1,t.mentionCount)+100*e;await this.prisma.trendingTopic.update({where:{id:t.id},data:{velocity:e,trendScore:n,isTrending:n>50&&e>1}})}}catch(e){throw console.error("Error calculating topic trending scores:",e),e}}async getTopTrendingTweets(e){return(await this.prisma.tweet.findMany({where:{isTrending:!0,createdAt:{gte:new Date(Date.now()-6048e5)}},include:{account:!0},orderBy:{trendingScore:"desc"},take:e})).map(e=>({id:e.id,content:e.content,engagementScore:e.engagementScore,trendingScore:e.trendingScore,account:e.account.username,createdAt:e.createdAt}))}async getTopTrendingTopics(e){return(await this.prisma.trendingTopic.findMany({where:{isTrending:!0,isActive:!0},orderBy:{trendScore:"desc"},take:e})).map(e=>({topic:e.topic,type:e.type,trendScore:e.trendScore,velocity:e.velocity,mentionCount:e.mentionCount}))}async generateInsights(e){try{let t=await this.prisma.tweet.count({where:{isTrending:!0,createdAt:{gte:e}}}),n=await this.prisma.tweet.aggregate({where:{createdAt:{gte:e}},_avg:{engagementScore:!0}}),r=await this.prisma.tweet.groupBy({by:["accountId"],where:{createdAt:{gte:e}},_avg:{engagementScore:!0},_count:{id:!0},orderBy:{_avg:{engagementScore:"desc"}},take:5}),a=await Promise.all(r.map(async e=>{let t=await this.prisma.account.findUnique({where:{id:e.accountId},select:{username:!0}});return t?.username||"Unknown"})),i=await this.prisma.trendingTopic.findMany({where:{velocity:{gt:2},firstSeen:{gte:new Date(Date.now()-864e5)},isActive:!0},orderBy:{velocity:"desc"},take:10,select:{topic:!0}});return{totalTrending:t,averageEngagement:n._avg.engagementScore||0,topPerformingAccounts:a,emergingTopics:i.map(e=>e.topic)}}catch(e){return console.error("Error generating insights:",e),{totalTrending:0,averageEngagement:0,topPerformingAccounts:[],emergingTopics:[]}}}async getAccountAnalytics(e,t=30){let n=new Date(Date.now()-864e5*t),r=await this.prisma.account.findUnique({where:{username:e},include:{tweets:{where:{createdAt:{gte:n}},orderBy:{engagementScore:"desc"}}}});if(!r)throw Error(`Account @${e} not found`);let a=r.tweets.length,i=a>0?r.tweets.reduce((e,t)=>e+t.engagementScore,0)/a:0;return{totalTweets:a,averageEngagement:i,topTweets:r.tweets.slice(0,10).map(e=>({content:e.content,engagementScore:e.engagementScore,createdAt:e.createdAt})),trendingTweets:r.tweets.filter(e=>e.isTrending).length,engagementTrend:await this.generateEngagementTrend(r.id,t)}}async generateEngagementTrend(e,t){let n=[];for(let r=t-1;r>=0;r--){let t=new Date(Date.now()-864e5*r),a=new Date(t.getTime()+864e5),i=await this.prisma.tweet.aggregate({where:{accountId:e,createdAt:{gte:t,lt:a}},_avg:{engagementScore:!0}});n.push({date:t.toISOString().split("T")[0],engagement:i._avg.engagementScore||0})}return n}}let a=r}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[372,609],()=>n(3258));module.exports=r})();